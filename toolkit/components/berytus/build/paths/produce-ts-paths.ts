/* This Source Code Form is subject to the terms of the Mozilla Public
 * License, v. 2.0. If a copy of the MPL was not distributed with this
 * file, You can obtain one at http://mozilla.org/MPL/2.0/. */

import { writeFile } from 'node:fs/promises';
import { resolve } from 'node:path';
import { produceAnyPaths } from './produce-any-paths.js';
import { produceBerytusPaths } from './produce-berytus-paths.js';

export interface PathEntry {
    path: string;
    target: Array<string>;
}

const run = async () => {
    const anyPaths = await produceAnyPaths();
    const berytusPaths = await produceBerytusPaths();

    const paths = [...berytusPaths, ...anyPaths].map(({ path, target}) => {
        return `"${path}": ${JSON.stringify(target)}`;
    });

    await writeFile(
        resolve("./tsconfig.module-paths.json"),
        `// This file is automatically generated; do not edit.
{
    "compilerOptions": {
        "paths": {
            ${paths.join(",\n\t\t\t")}
        }
    }
}`,
        { encoding: 'utf8' }
    );
}

run();
